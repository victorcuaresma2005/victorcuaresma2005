<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IOS Dev Club - Tienda Digital Premium</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .glass-effect {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .card-hover {
      transition: all 0.3s ease;
    }
    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }
    
    /* QR Popup Styles */
    .qr-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn 0.5s ease-out;
    }
    
    .qr-popup {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 20px;
      padding: 30px;
      text-align: center;
      max-width: 400px;
      width: 100%;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.5s ease-out;
      position: relative;
    }
    
    .qr-popup h2 {
      color: white;
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 15px;
    }
    
    .qr-popup p {
      color: rgba(255, 255, 255, 0.9);
      margin-bottom: 20px;
      font-size: 1rem;
    }
    
    .qr-image {
      width: 250px;
      height: auto;
      max-height: 200px;
      border-radius: 15px;
      margin: 0 auto 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      object-fit: contain;
    }
    
    .qr-close-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 35px;
      height: 35px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    
    .qr-close-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.1);
    }
    
    .qr-support-btn {
      background: linear-gradient(45deg, #ff6b6b, #ee5a24);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 25px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
    }
    
    .qr-support-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideUp {
      from { 
        opacity: 0;
        transform: translateY(50px) scale(0.9);
      }
      to { 
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
    
    /* Mobile Responsive */
    @media (max-width: 768px) {
      .qr-popup {
        padding: 25px 20px;
        margin: 10px;
        max-width: 350px;
      }
      
      .qr-popup h2 {
        font-size: 1.3rem;
      }
      
      .qr-image {
        width: 220px;
        height: auto;
        max-height: 180px;
      }
      
      .qr-popup p {
        font-size: 0.9rem;
      }
    }
    
    @media (max-width: 480px) {
      .qr-popup {
        padding: 20px 15px;
        margin: 5px;
        max-width: 320px;
      }
      
      .qr-image {
        width: 200px;
        height: auto;
        max-height: 160px;
      }
      
      .qr-popup h2 {
        font-size: 1.2rem;
      }
    }
    
    /* Video Player Popup Styles */
    .video-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(5px);
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn 0.5s ease-out;
    }
    
    .video-popup {
      background: #1a1a1a;
      border-radius: 15px;
      padding: 20px;
      max-width: 90vw;
      max-height: 90vh;
      width: 100%;
      height: 100%;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
      animation: slideUp 0.5s ease-out;
      position: relative;
      display: flex;
      flex-direction: column;
    }
    
    .video-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #333;
    }
    
    .video-title {
      color: white;
      font-size: 1.2rem;
      font-weight: bold;
      margin: 0;
    }
    
    .video-close-btn {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    
    .video-close-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.1);
    }
    
    .video-container {
      flex: 1;
      width: 100%;
      border-radius: 10px;
      overflow: hidden;
    }
    
    .video-iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 10px;
    }
    
    .copyright-footer {
      position: fixed;
      bottom: 10px;
      right: 10px;
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.8rem;
      background: rgba(0, 0, 0, 0.3);
      padding: 5px 10px;
      border-radius: 15px;
      backdrop-filter: blur(5px);
    }
    
    @media (max-width: 768px) {
      .video-popup {
        padding: 15px;
        max-width: 95vw;
        max-height: 95vh;
      }
      
      .video-title {
        font-size: 1rem;
      }
      
      .video-close-btn {
        width: 35px;
        height: 35px;
        font-size: 18px;
      }
    }
  </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">
  
  <!-- Video Player Popup -->
  <div id="videoPopup" class="video-overlay" style="display: none;">
    <div class="video-popup">
      <div class="video-header">
        <h3 class="video-title" id="videoTitle">Reproduciendo video</h3>
        <button class="video-close-btn" onclick="closeVideoPopup()">√ó</button>
      </div>
      <div class="video-container">
        <iframe id="videoIframe" class="video-iframe" allowfullscreen></iframe>
      </div>
    </div>
  </div>
  
  <!-- QR Support Popup -->
  <div id="qrPopup" class="qr-overlay">
    <div class="qr-popup">
      <button class="qr-close-btn" onclick="closeQRPopup()">√ó</button>
      <h2>üíù Apoya esta p√°gina</h2>
      <p>Escanea el c√≥digo QR para apoyar el desarrollo de esta plataforma</p>
      <img src="https://drive.google.com/thumbnail?id=1qgDnlE0HrU27eWxn8SDoANG5XOTrXOGC&sz=w400" 
           alt="QR de Apoyo" 
           class="qr-image"
           onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjNmNGY2Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzY2NjY2NiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkVSUk9SPC90ZXh0Pjwvc3ZnPg=='">
      <button class="qr-support-btn" onclick="closeQRPopup()">
        ‚ú® ¬°Gracias por tu apoyo!
      </button>
    </div>
  </div>
  
  <!-- Login Container -->
  <div id="loginContainer" class="w-full max-w-md">
    <div class="glass-effect rounded-2xl p-8 shadow-2xl">
      <!-- Logo/Header -->
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-white mb-2">üé¨ IOS Dev Club</h1>
        <p class="text-gray-200">Accede a contenido exclusivo</p>
      </div>

      <!-- Login Form -->
      <form id="loginForm" class="space-y-6">
        <div>
          <label for="email" class="block text-sm font-medium text-white mb-2">Correo Electr√≥nico</label>
          <input 
            type="email" 
            id="email" 
            required
            class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-white/50 focus:border-transparent"
            placeholder="tu@email.com"
          />
        </div>
        
        <div>
          <label for="password" class="block text-sm font-medium text-white mb-2">Contrase√±a</label>
          <input 
            type="password" 
            id="password" 
            required
            class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-white/50 focus:border-transparent"
            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
          />
        </div>

        <button 
          type="submit" 
          class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700 transition-all duration-300 transform hover:scale-105"
        >
          üîê Iniciar Sesi√≥n
        </button>
      </form>

      <!-- Divider -->
      <div class="flex items-center my-6">
        <div class="flex-1 border-t border-white/30"></div>
        <span class="px-4 text-white/70 text-sm">o</span>
        <div class="flex-1 border-t border-white/30"></div>
      </div>

      <!-- MetaMask Button -->
      <button 
        id="connectBtn" 
        class="w-full bg-gradient-to-r from-orange-500 to-yellow-500 text-white py-3 rounded-lg font-semibold hover:from-orange-600 hover:to-yellow-600 transition-all duration-300 transform hover:scale-105 flex items-center justify-center space-x-2"
      >
        <span>ü¶ä</span>
        <span>Conectar con MetaMask</span>
      </button>

      <!-- Error Message -->
      <div id="errorMessage" class="mt-4 p-3 bg-red-500/20 border border-red-500/30 rounded-lg text-red-200 text-sm hidden"></div>
    </div>
  </div>

  <!-- Store Container (Hidden initially) -->
  <div id="storeContainer" class="w-full max-w-7xl hidden">
    <!-- Header -->
    <div class="glass-effect rounded-2xl p-6 mb-8">
      <div class="flex justify-between items-center">
        <div>
          <h1 class="text-3xl font-bold text-white mb-2">üõí IOS Dev Club Store</h1>
          <p class="text-gray-200">Contenido digital premium</p>
        </div>
        <button 
          id="disconnectBtn" 
          class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg font-semibold transition-all duration-300"
        >
          Desconectar
        </button>
      </div>
      <div id="accountInfo" class="mt-4 text-white"></div>
    </div>

    <!-- Products Grid -->
    <div id="products" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
  </div>

  <!-- Direct Access Container (Hidden initially) -->
  <div id="directAccessContainer" class="w-full max-w-md hidden">
    <div class="glass-effect rounded-2xl p-8 shadow-2xl text-center">
      <h2 class="text-2xl font-bold text-white mb-4">üéâ Acceso Autorizado</h2>
      <p class="text-gray-200 mb-6">Bienvenido al contenido premium</p>
      <a 
        href="https://drive.google.com/drive/folders/1cPVaKYAMi6yufkxFN24fCBBRGU-a7mlW?usp=sharing" 
        target="_blank"
        class="inline-block bg-gradient-to-r from-green-500 to-blue-500 text-white px-8 py-3 rounded-lg font-semibold hover:from-green-600 hover:to-blue-600 transition-all duration-300 transform hover:scale-105"
      >
        üëÅÔ∏è Ver Contenido
      </a>
    </div>
  </div>

  <!-- Copyright Footer -->
  <div class="copyright-footer">
    ¬© 2025-2026 IOS Dev Club. Todos los derechos reservados.
  </div>

  <script>
    let provider, signer, currentAccount;

    // Direcci√≥n de destino del pago
    const ownerAddress = "0xCC48BBE0D4260F1012D93Ad856729954532389F2";

    // Credenciales v√°lidas
    const validCredentials = {
      email: "noiting@noiting.com.pe",
      password: "RealHastaLaMuerte2025"
    };

    // Productos
    const productos = [

     {
        id: "1",
        nombre: "Karol G - Ma√±ana fue muy bonito (Documental)",
        img: "https://www.infobae.com/resizer/v2/Q2TAZOOMVFEX7LLAEMGLR7EZQQ.png?auth=9ead9e209f0c1f622fc77e75a07ed706cfede9d5e4303e0937f4ac8089995084&smart=true&width=1200&height=900&quality=85",
        precio: "1.99",
        url: "https://drive.google.com/file/d/1mJqbmfPX9ZZySWLv1-4IVP1ZhO_RxE6H/view?usp=sharing"
      },

     {
        id: "2",
        nombre: "Academia De Vampiros",
        img: "https://is1-ssl.mzstatic.com/image/thumb/Cls6lXvubIRLYFDR4eezjg/1200x675.jpg",
        precio: "1.55",
        url: "https://drive.google.com/file/d/1mJqbmfPX9ZZySWLv1-4IVP1ZhO_RxE6H/view?usp=sharing"
      },
     {
        id: "3",
        nombre: "Las Aventuras de Peabody y Sherman",
        img: "https://occ-0-8407-114.1.nflxso.net/dnm/api/v6/6AYY37jfdO6hpXcMjf9Yu5cnmO0/AAAABcnyWcyW5QD-CD1xr2OP5AQi-4L-OIOYj6a_E9lfwth0doj-gG93hhKSuPy8TSvcAcJwazPUXX-GPaMlP06bswY6QQHAP87AxPvV.jpg?r=d81",
        precio: "1.66",
        url: "https://drive.google.com/file/d/1husYPOLJuHPY1r7J1h7NCGsNzk0BpRfK/view?usp=sharing"
      },
           {
        id: "4",
        nombre: "Lluvia de hamburguesas 1",
        img: "https://occ-0-8407-90.1.nflxso.net/dnm/api/v6/Z-WHgqd_TeJxSuha8aZ5WpyLcX8/AAAABaP9sJsjJJdpzf2sHg93qqx4WuF_qoPKybpY6nt4t3pVImT9-QirEumblatyqDTAWYQ-g8kY3yDm--jPVzi2RZAIJRs0T3lmKd19.jpg?r=7fb",
        precio: "1.60",
        url: "https://drive.google.com/file/d/1erVXwgKBJv-vQi8gn8DQqvnhGoXfNC-8/view?usp=sharing"
      },
           {
        id: "5",
        nombre: "Shrek 2",
        img: "https://occ-0-8407-116.1.nflxso.net/dnm/api/v6/E8vDc_W8CLv7-yMQu8KMEC7Rrr8/AAAABQ--mbHAzmMy-OIRerrMrUUP8Gxlk4DUS873njxuCOuM5N0JpV81tUo4Q28HOUSa2qaoSAA5NVpOC5Yw2rvYKvQ1hpnxTSrmw4B8.jpg?r=060",
        precio: "1.70",
        url: "https://drive.google.com/file/d/1REoLDN_wMSUq3aKvxYl00m8tJ0_I57Vp/view?usp=sharing"
      },
          {
        id: "6",
        nombre: "Shrek 1",
        img: "https://m.media-amazon.com/images/S/pv-target-images/d5907b466d025b3852bb53c7b729a7acfa41efd68b4a875794ef29751b090446.jpg",
        precio: "1.70",
        url: "https://drive.google.com/file/d/1j37RLFaOPiA4G87RL4sKsE5rKCVdDahU/view?usp=sharing"
      },
          {
        id: "7",
        nombre: "Shrek 3",
        img: "https://images-2.rakuten.tv/storage/snapshot/shot/442fe870-8250-41c7-b063-07b0b8fd45d5-snapshot-1590662809-width936-quality90.jpeg",
        precio: "1.70",
        url: "https://drive.google.com/file/d/1ew9NpABQYA3RZ4mWgTXyoafrrmsI8J7E/view?usp=sharing"
      },
          {
        id: "8",
        nombre: "Rapunzel (Enredados)",
        img: "https://i.ytimg.com/vi/Oqi-1rdyBnA/hq720.jpg?sqp=-oaymwEhCK4FEIIDSFryq4qpAxMIARUAAAAAGAElAADIQj0AgKJD&rs=AOn4CLD6p3f5MPyqLfZuYlyAfxVlrJznHQ",
        precio: "1.22",
        url: "https://drive.google.com/file/d/1ew9NpABQYA3RZ4mWgTXyoafrrmsI8J7E/view?usp=sharing"
      },
          {
        id: "9",
        nombre: "Paquete Completo de Dramas en Espa√±ol",
        img: "https://6.soompi.io/wp-content/uploads/image/viki-dramas.jpg?s=900x600&e=t",
        precio: "29.99",
        url: "https://acortar.link/OFNzlV"
      },
          {
        id: "10",
        nombre: "Culpa Mia",
        img: "https://m.media-amazon.com/images/S/pv-target-images/ca18e17ac7557fc729ecfca9e5abb4b531e49bf818ce37b8c4407f70995d0fc7.png",
        precio: "1.33",
        url: "https://drive.google.com/file/d/1Z9ONQ3JPHm3C8YbAmTbYLFP1lFKGgN7j/view?usp=sharing"
      },
          {
        id: "11",
        nombre: "Tres metros sobre el cielo",
        img: "https://beam-images.warnermediacdn.com/BEAM_LWM_DELIVERABLES/fe1519d3-33c2-42b6-885d-616a1dfc4307/16b22e0d-df73-43fa-a0e5-10f4e348fe09?host=wbd-images.prod-vod.h264.io&partner=beamcom&w=500",
        precio: "1.09",
        url: "https://drive.google.com/file/d/1TWOTB7SeIWC2u9okBQQ3733UAYpQ6RUQ/view?usp=sharing"
      },
          {
        id: "12",
        nombre: "Kung Fu Panda 3",
        img: "https://i.ytimg.com/vi/10r9ozshGVE/maxresdefault.jpg",
        precio: "1.15",
        url: "https://drive.google.com/file/d/1gUsvSM8lBuNjogNnlUiUYpHFsIi8viyn/view?usp=sharing"
      },

    ];

    // üîë Guardar compras por wallet
    function getPurchases() {
      const data = localStorage.getItem("purchases");
      return data ? JSON.parse(data) : {};
    }

    function savePurchase(account, productId) {
      const purchases = getPurchases();
      if (!purchases[account]) purchases[account] = [];
      if (!purchases[account].includes(productId)) {
        purchases[account].push(productId);
      }
      localStorage.setItem("purchases", JSON.stringify(purchases));
    }

    function hasPurchased(account, productId) {
      const purchases = getPurchases();
      return purchases[account]?.includes(productId);
    }

    // Mostrar error
    function showError(message) {
      const errorDiv = document.getElementById("errorMessage");
      errorDiv.textContent = message;
      errorDiv.classList.remove("hidden");
      setTimeout(() => {
        errorDiv.classList.add("hidden");
      }, 5000);
    }

    // Validar credenciales
    function validateCredentials(email, password) {
      return email === validCredentials.email && password === validCredentials.password;
    }

    // Cambiar vista
    function showView(viewName) {
      document.getElementById("loginContainer").classList.add("hidden");
      document.getElementById("storeContainer").classList.add("hidden");
      document.getElementById("directAccessContainer").classList.add("hidden");
      
      document.getElementById(viewName).classList.remove("hidden");
    }

    // Renderizar productos
    function renderProductos() {
      const cont = document.getElementById("products");
      cont.innerHTML = "";
      productos.forEach((p, i) => {
        const comprado = currentAccount && hasPurchased(currentAccount, p.id);
        const div = document.createElement("div");
        div.className = "glass-effect rounded-xl p-6 card-hover";
        div.innerHTML = `
          <img src="${p.img}" class="w-full h-48 object-cover rounded-lg mb-4"/>
          <h3 class="text-xl font-bold text-white mb-2">${p.nombre}</h3>
          <p class="text-gray-200 mb-4">${p.precio} ETH</p>
          <div id="actions-${i}">
            ${comprado
              ? `<button onclick="showVideoPopup(productos[${i}])" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white px-4 py-2 rounded-lg font-semibold hover:from-purple-600 hover:to-pink-600 transition-all duration-300">üé• Ver producto</button>`
              : `<button onclick="pay(${i})" class="w-full bg-gradient-to-r from-green-500 to-blue-500 text-white px-4 py-2 rounded-lg font-semibold hover:from-green-600 hover:to-blue-600 transition-all duration-300">Pagar</button>`
            }
          </div>
        `;
        cont.appendChild(div);
      });
    }

    // Conectar MetaMask
    async function connectMetaMask() {
      if (typeof window.ethereum === "undefined") {
        showError("MetaMask no est√° instalado.");
        return;
      }
      try {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        currentAccount = await signer.getAddress();

        const balance = await provider.getBalance(currentAccount);
        const ethBalance = ethers.utils.formatEther(balance);

        document.getElementById("accountInfo").innerHTML = `
          <div class="bg-white/10 rounded-lg p-4">
            <p class="text-white font-semibold">Conectado: ${currentAccount}</p>
            <p class="text-gray-200">Saldo: ${parseFloat(ethBalance).toFixed(4)} ETH</p>
          </div>
        `;

        showView("storeContainer");
        renderProductos();
      } catch (err) {
        console.error(err);
        showError("Error al conectar MetaMask.");
      }
    }

    // Desconectar
    function disconnectMetaMask() {
      currentAccount = null;
      signer = null;
      provider = null;
      showView("loginContainer");
    }

    // Pago
    async function pay(i) {
      if (!signer) {
        showError("Primero conecta MetaMask.");
        return;
      }
      try {
        const tx = await signer.sendTransaction({
          to: ownerAddress,
          value: ethers.utils.parseEther(productos[i].precio)
        });
        console.log("TX enviada:", tx.hash);
        await tx.wait();

        // Guardar compra de este usuario
        savePurchase(currentAccount, productos[i].id);

        renderProductos(); // refrescar vista
        alert("Pago realizado con √©xito üéâ Ahora puedes ver tu producto.");
      } catch (err) {
        console.error("Error durante el pago:", err);
        showError("Error durante el pago: " + err.message);
      }
    }

    // Eventos
    document.getElementById("loginForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      
      if (validateCredentials(email, password)) {
        showView("directAccessContainer");
      } else {
        showError("Credenciales incorrectas. Int√©ntalo de nuevo.");
      }
    });

    document.getElementById("connectBtn").addEventListener("click", connectMetaMask);
    document.getElementById("disconnectBtn").addEventListener("click", disconnectMetaMask);

    // Funci√≥n para extraer ID del enlace de Google Drive
    function extractDriveId(url) {
      // Para enlaces tipo: https://drive.google.com/file/d/ID/view
      const fileMatch = url.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
      if (fileMatch) return fileMatch[1];
      
      // Para enlaces tipo: https://drive.google.com/drive/folders/ID
      const folderMatch = url.match(/\/folders\/([a-zA-Z0-9_-]+)/);
      if (folderMatch) return folderMatch[1];
      
      return null;
    }

    // Funci√≥n para mostrar video en popup
    function showVideoPopup(producto) {
      const videoPopup = document.getElementById("videoPopup");
      const videoTitle = document.getElementById("videoTitle");
      const videoIframe = document.getElementById("videoIframe");
      
      const driveId = extractDriveId(producto.url);
      if (!driveId) {
        // Si no es un enlace de Drive v√°lido, abrir en nueva pesta√±a
        window.open(producto.url, '_blank');
        return;
      }
      
      videoTitle.textContent = producto.nombre;
      
      // Crear URL embebida de Google Drive
      const embedUrl = `https://drive.google.com/file/d/${driveId}/preview`;
      videoIframe.src = embedUrl;
      
      videoPopup.style.display = "flex";
    }

    // Funci√≥n para cerrar el popup de video
    function closeVideoPopup() {
      const videoPopup = document.getElementById("videoPopup");
      const videoIframe = document.getElementById("videoIframe");
      
      videoPopup.style.animation = "fadeOut 0.3s ease-out";
      setTimeout(() => {
        videoPopup.style.display = "none";
        videoIframe.src = ""; // Detener la reproducci√≥n
        videoPopup.style.animation = "";
      }, 300);
    }

    // Funci√≥n para extraer ID del enlace de Google Drive
    function extractDriveId(url) {
      // Para enlaces tipo: https://drive.google.com/file/d/ID/view
      const fileMatch = url.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
      if (fileMatch) return fileMatch[1];
      
      // Para enlaces tipo: https://drive.google.com/drive/folders/ID
      const folderMatch = url.match(/\/folders\/([a-zA-Z0-9_-]+)/);
      if (folderMatch) return folderMatch[1];
      
      return null;
    }

    // Funci√≥n para mostrar video en popup
    function showVideoPopup(producto) {
      const videoPopup = document.getElementById("videoPopup");
      const videoTitle = document.getElementById("videoTitle");
      const videoIframe = document.getElementById("videoIframe");
      
      const driveId = extractDriveId(producto.url);
      if (!driveId) {
        // Si no es un enlace de Drive v√°lido, abrir en nueva pesta√±a
        window.open(producto.url, '_blank');
        return;
      }
      
      videoTitle.textContent = producto.nombre;
      
      // Crear URL embebida de Google Drive
      const embedUrl = `https://drive.google.com/file/d/${driveId}/preview`;
      videoIframe.src = embedUrl;
      
      videoPopup.style.display = "flex";
    }

    // Funci√≥n para cerrar el popup de video
    function closeVideoPopup() {
      const videoPopup = document.getElementById("videoPopup");
      const videoIframe = document.getElementById("videoIframe");
      
      videoPopup.style.animation = "fadeOut 0.3s ease-out";
      setTimeout(() => {
        videoPopup.style.display = "none";
        videoIframe.src = ""; // Detener la reproducci√≥n
        videoPopup.style.animation = "";
      }, 300);
    }

    // Funci√≥n para cerrar el popup QR
    function closeQRPopup() {
      const qrPopup = document.getElementById("qrPopup");
      qrPopup.style.animation = "fadeOut 0.3s ease-out";
      setTimeout(() => {
        qrPopup.style.display = "none";
      }, 300);
    }

    // Auto-cerrar el popup despu√©s de 10 segundos
    function autoCloseQR() {
      setTimeout(() => {
        if (document.getElementById("qrPopup").style.display !== "none") {
          closeQRPopup();
        }
      }, 10000);
    }

    // Inicializar
    showView("loginContainer");
    
    // Mostrar popup QR al cargar la p√°gina
    document.addEventListener("DOMContentLoaded", function() {
      autoCloseQR();
    });
  </script>
</body>
</html>